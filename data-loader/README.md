# data-loader

### Overview

All of the code saved in this subdirectory is for feeding data into the project's database
- Project database is saved on Lisa -> `lisa.luddy.indiana.edu` 
    - See the [CNetS onboarding documents](https://github.iu.edu/cnets-team/onboarding/wiki/Computing#cnets-servers) for more details on Lisa and CNetS servers
- The data that is fed to the database are generated by scripts saved in `scripts/data_processing/` directory 
- The entire process of feeding data into the database is executed by the `run_data_loader.sh` script
    - **This script executes every month as part of the `scripts/monthly_master_script.sh` script and should not be run directly**
- This script makes connection to Lisa via ssh tunneling

---

> ### IMPORTANT:
> 1. Must run scripts from the `/home/data/apps/topfibers/repo/data-loader` directory or scripts will break
> 2. Must configure database prior to feeding data to the database
> 3. The data files that will be added to the database will be saved here:
>     - `/home/data/apps/topfibers/repo/data/derived/fib_results/twitter/year_month`
>     - `/home/data/apps/topfibers/repo/data/derived/fib_results/facebook/year_month`
>         - `year_month` in the paths above represent `YYYY_mm` datetime formats

---
### Contents

### Directories
- `app`: Contains functions that read parquet files and redirect the data into different database functions
- `conf`: Contains the database configuartion file `fibindex.conf`
- `database_functions`: Contains function that are utilized to update the tables within the database. Each function is named after the table that it updates. The tables are: `fib_indices`, `posts`,  `reports`, `reshares`.
    - See the database schema [here](https://docs.google.com/spreadsheets/d/1gfAyLKk0VwQK1KLDgAWemWxw4wMM7_pyLtkgzAFehko/edit?usp=sharing)
- `database_script`: Contains the script that creates the database (`create.sql`)
- `library`: Contains utility functions for working with the database

### Files
- `server.py`: this is the main python script that is executed by the `run_data_loader.sh` script. It fetches the current month of data and sends it to database.